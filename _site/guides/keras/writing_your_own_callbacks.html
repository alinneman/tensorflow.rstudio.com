<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-99.9.9">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Guide to writing Keras callbacks for customizing the behavior during model training, evaluation, or inference.">

<title>TensorFlow for R - Writing your own callbacks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../guides/keras/transfer_learning.html" rel="next">
<link href="../../guides/keras/understanding_masking_and_padding.html" rel="prev">
<link href="../../images/favicon/icon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <img src="../../images/favicon/icon.png" alt="">
    <span class="navbar-title">TensorFlow for R</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../install/">Install</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/">Tutorials</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guides/">Guides</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../examples/">Examples</a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-reference" role="button" data-bs-toggle="dropdown" aria-expanded="false">Reference</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-reference">    
        <li>
    <a class="dropdown-item" href="../../reference/tensorflow/index.html">
 <span class="dropdown-text">tensorlow</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/keras/index.html">
 <span class="dropdown-text">keras</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/tfdatasets/index.html">
 <span class="dropdown-text">tfdatasets</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/tfautograph/index.html">
 <span class="dropdown-text">tfautograph</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/tfhub/index.html">
 <span class="dropdown-text">tfhub</span></a>
  </li>  
    </ul>
  </li>
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Writing your own callbacks</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/index.html" class="sidebar-item-text sidebar-link">Guides</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Tensorflow Basics</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/tensorflow/basics.html" class="sidebar-item-text sidebar-link">Overview</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/tensorflow/tensor.html" class="sidebar-item-text sidebar-link">Tensors</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/tensorflow/variable.html" class="sidebar-item-text sidebar-link">Variables</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/tensorflow/autodiff.html" class="sidebar-item-text sidebar-link">Automatic differentiation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/tensorflow/intro_to_graphs.html" class="sidebar-item-text sidebar-link">Graphs and functions</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Keras</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/keras/sequential_model.html" class="sidebar-item-text sidebar-link">The Sequential model</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/keras/functional_api.html" class="sidebar-item-text sidebar-link">The Functional API</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/keras/training_with_built_in_methods.html" class="sidebar-item-text sidebar-link">Training &amp; evaluation with the built-in methods</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/keras/making_new_layers_and_models_via_subclassing.html" class="sidebar-item-text sidebar-link">Making custom layer and model objects.</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/keras/serialization_and_saving.html" class="sidebar-item-text sidebar-link">Serialization and saving</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/keras/preprocessing_layers.html" class="sidebar-item-text sidebar-link">Working with preprocessing layers</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/keras/customizing_what_happens_in_fit.html" class="sidebar-item-text sidebar-link">Customizing what happens in <code>fit()</code></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/keras/writing_a_training_loop_from_scratch.html" class="sidebar-item-text sidebar-link">Writing a training loop from scratch</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/keras/working_with_rnns.html" class="sidebar-item-text sidebar-link">Working with RNNs</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/keras/understanding_masking_and_padding.html" class="sidebar-item-text sidebar-link">Understanding masking &amp; padding</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/keras/writing_your_own_callbacks.html" class="sidebar-item-text sidebar-link active">Writing your own callbacks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/keras/transfer_learning.html" class="sidebar-item-text sidebar-link">Transfer learning and fine-tuning</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">TensorFlow in depth</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/tensorflow/tensor_slicing.html" class="sidebar-item-text sidebar-link">Tensor Slicing</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/tfautograph/index.html" class="sidebar-item-text sidebar-link">Autograph</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Data input pipelines</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/tfdatasets/index.html" class="sidebar-item-text sidebar-link">Build TensorFlow input pipelines</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../guides/deploy/index.html" class="sidebar-item-text sidebar-link">Deployment</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/deploy/plumber.html" class="sidebar-item-text sidebar-link">Plumber API</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/deploy/shiny.html" class="sidebar-item-text sidebar-link">Deploying a Shiny app with a TensorFlow model</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guides/deploy/docker.html" class="sidebar-item-text sidebar-link">TensorFlow serving</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#keras-callbacks-overview" id="toc-keras-callbacks-overview" class="nav-link" data-scroll-target="#keras-callbacks-overview">Keras callbacks overview</a></li>
  <li><a href="#an-overview-of-callback-methods" id="toc-an-overview-of-callback-methods" class="nav-link" data-scroll-target="#an-overview-of-callback-methods">An overview of callback methods</a>
  <ul class="collapse">
  <li><a href="#global-methods" id="toc-global-methods" class="nav-link" data-scroll-target="#global-methods">Global methods</a></li>
  <li><a href="#batch-level-methods-for-trainingtestingpredicting" id="toc-batch-level-methods-for-trainingtestingpredicting" class="nav-link" data-scroll-target="#batch-level-methods-for-trainingtestingpredicting">Batch-level methods for training/testing/predicting</a></li>
  <li><a href="#epoch-level-methods-training-only" id="toc-epoch-level-methods-training-only" class="nav-link" data-scroll-target="#epoch-level-methods-training-only">Epoch-level methods (training only)</a></li>
  </ul></li>
  <li><a href="#a-basic-example" id="toc-a-basic-example" class="nav-link" data-scroll-target="#a-basic-example">A basic example</a>
  <ul class="collapse">
  <li><a href="#usage-of-logs" id="toc-usage-of-logs" class="nav-link" data-scroll-target="#usage-of-logs">Usage of <code>logs</code></a></li>
  </ul></li>
  <li><a href="#usage-of-selfmodel-attribute" id="toc-usage-of-selfmodel-attribute" class="nav-link" data-scroll-target="#usage-of-selfmodel-attribute">Usage of <code>self$model</code> attribute</a></li>
  <li><a href="#examples-of-keras-callback-applications" id="toc-examples-of-keras-callback-applications" class="nav-link" data-scroll-target="#examples-of-keras-callback-applications">Examples of Keras callback applications</a>
  <ul class="collapse">
  <li><a href="#early-stopping-at-minimum-loss" id="toc-early-stopping-at-minimum-loss" class="nav-link" data-scroll-target="#early-stopping-at-minimum-loss">Early stopping at minimum loss</a></li>
  <li><a href="#learning-rate-scheduling" id="toc-learning-rate-scheduling" class="nav-link" data-scroll-target="#learning-rate-scheduling">Learning rate scheduling</a></li>
  <li><a href="#built-in-keras-callbacks" id="toc-built-in-keras-callbacks" class="nav-link" data-scroll-target="#built-in-keras-callbacks">Built-in Keras callbacks</a></li>
  </ul></li>
  <li><a href="#environment-details" id="toc-environment-details" class="nav-link" data-scroll-target="#environment-details">Environment Details</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/t-kalinowski/tf-site/edit/main/guides/keras/writing_your_own_callbacks.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/t-kalinowski/tf-site/blob/main/guides/keras/writing_your_own_callbacks.qmd" class="toc-action">View source</a></p><p><a href="https://github.com/t-kalinowski/tf-site/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Writing your own callbacks</h1>
</div>

<div>
  <div class="description">
    <p>Guide to writing Keras callbacks for customizing the behavior during model training, evaluation, or inference.</p>
  </div>
</div>


<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>A callback is a powerful tool to customize the behavior of a Keras model during training, evaluation, or inference. Examples include <code>callback_tensorboard()</code> to visualize training progress and results with TensorBoard, or <code>callback_model_checkpoint()</code> to periodically save your model during training.</p>
<p>In this guide, you will learn what a Keras callback is, what it can do, and how you can build your own. We provide a few demos of simple callback applications to get you started.</p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tensorflow)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>envir<span class="sc">::</span><span class="fu">import_from</span>(dplyr, last)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tf_version</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded Tensorflow version 2.9.1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] '2.9'</code></pre>
</div>
</div>
</section>
<section id="keras-callbacks-overview" class="level2">
<h2 class="anchored" data-anchor-id="keras-callbacks-overview">Keras callbacks overview</h2>
<p>All callbacks subclass the <code>keras$callbacks$Callback</code> class, and override a set of methods called at various stages of training, testing, and predicting. Callbacks are useful to get a view on internal states and statistics of the model during training.</p>
<p>You can pass a list of callbacks (as a named argument <code>callbacks</code>) to the following keras model methods:</p>
<ul>
<li><code>fit()</code></li>
<li><code>evaluate()</code></li>
<li><code>predict()</code></li>
</ul>
<!-- -->
</section>
<section id="an-overview-of-callback-methods" class="level2">
<h2 class="anchored" data-anchor-id="an-overview-of-callback-methods">An overview of callback methods</h2>
<section id="global-methods" class="level3">
<h3 class="anchored" data-anchor-id="global-methods">Global methods</h3>
<section id="on_traintestpredict_beginlogs-null" class="level4">
<h4 class="anchored" data-anchor-id="on_traintestpredict_beginlogs-null"><code>on_(train|test|predict)_begin(logs = NULL)</code></h4>
<p>Called at the beginning of <code>fit</code>/<code>evaluate</code>/<code>predict</code>.</p>
</section>
<section id="on_traintestpredict_endlogs-null" class="level4">
<h4 class="anchored" data-anchor-id="on_traintestpredict_endlogs-null"><code>on_(train|test|predict)_end(logs = NULL)</code></h4>
<p>Called at the end of <code>fit</code>/<code>evaluate</code>/<code>predict</code>.</p>
</section>
</section>
<section id="batch-level-methods-for-trainingtestingpredicting" class="level3">
<h3 class="anchored" data-anchor-id="batch-level-methods-for-trainingtestingpredicting">Batch-level methods for training/testing/predicting</h3>
<section id="on_traintestpredict_batch_beginlogs-null" class="level4">
<h4 class="anchored" data-anchor-id="on_traintestpredict_batch_beginlogs-null"><code>on_(train|test|predict)_batch_begin(logs = NULL)</code></h4>
<p>Called right before processing a batch during training/testing/predicting.</p>
</section>
<section id="on_traintestpredict_batch_endbatch-logs-null" class="level4">
<h4 class="anchored" data-anchor-id="on_traintestpredict_batch_endbatch-logs-null"><code>on_(train|test|predict)_batch_end(batch, logs = NULL)</code></h4>
<p>Called at the end of training/testing/predicting a batch. Within this method, <code>logs</code> is a dict containing the metrics results.</p>
</section>
</section>
<section id="epoch-level-methods-training-only" class="level3">
<h3 class="anchored" data-anchor-id="epoch-level-methods-training-only">Epoch-level methods (training only)</h3>
<section id="on_epoch_beginepoch-logs-null" class="level4">
<h4 class="anchored" data-anchor-id="on_epoch_beginepoch-logs-null"><code>on_epoch_begin(epoch, logs = NULL)</code></h4>
<p>Called at the beginning of an epoch during training.</p>
</section>
<section id="on_epoch_endepoch-logs-null" class="level4">
<h4 class="anchored" data-anchor-id="on_epoch_endepoch-logs-null"><code>on_epoch_end(epoch, logs = NULL)</code></h4>
<p>Called at the end of an epoch during training.</p>
</section>
</section>
</section>
<section id="a-basic-example" class="level2">
<h2 class="anchored" data-anchor-id="a-basic-example">A basic example</h2>
<p>Let’s take a look at a concrete example. To get started, let’s import tensorflow and define a simple Sequential Keras model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>get_model <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">keras_model_sequential</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layer_dense</span>(<span class="dv">1</span>, <span class="at">input_shape =</span> <span class="dv">784</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">compile</span>(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">optimizer =</span> <span class="fu">optimizer_rmsprop</span>(<span class="at">learning_rate=</span><span class="fl">0.1</span>),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">loss =</span> <span class="st">"mean_squared_error"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">metrics =</span> <span class="st">"mean_absolute_error"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  model</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, load the MNIST data for training and testing from Keras datasets API:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mnist <span class="ot">&lt;-</span> <span class="fu">dataset_mnist</span>()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>flatten_and_rescale <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">array_reshape</span>(x, <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">784</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">/</span> <span class="dv">255</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>mnist<span class="sc">$</span>train<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">flatten_and_rescale</span>(mnist<span class="sc">$</span>train<span class="sc">$</span>x)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>mnist<span class="sc">$</span>test<span class="sc">$</span>x  <span class="ot">&lt;-</span> <span class="fu">flatten_and_rescale</span>(mnist<span class="sc">$</span>test<span class="sc">$</span>x)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># limit to 500 samples</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>mnist<span class="sc">$</span>train<span class="sc">$</span>x <span class="ot">&lt;-</span> mnist<span class="sc">$</span>train<span class="sc">$</span>x[<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>, ]</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>mnist<span class="sc">$</span>train<span class="sc">$</span>y <span class="ot">&lt;-</span> mnist<span class="sc">$</span>train<span class="sc">$</span>y[<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>]</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>mnist<span class="sc">$</span>test<span class="sc">$</span>x  <span class="ot">&lt;-</span> mnist<span class="sc">$</span>test<span class="sc">$</span>x[<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>, ]</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>mnist<span class="sc">$</span>test<span class="sc">$</span>y  <span class="ot">&lt;-</span> mnist<span class="sc">$</span>test<span class="sc">$</span>y[<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, define a simple custom callback that logs:</p>
<ul>
<li>When <code>fit</code>/<code>evaluate</code>/<code>predict</code> starts &amp; ends</li>
<li>When each epoch starts &amp; ends</li>
<li>When each training batch starts &amp; ends</li>
<li>When each evaluation (test) batch starts &amp; ends</li>
<li>When each inference (prediction) batch starts &amp; ends</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>show <span class="ot">&lt;-</span> <span class="cf">function</span>(msg, logs) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(glue<span class="sc">::</span><span class="fu">glue</span>(msg, <span class="at">.envir =</span> <span class="fu">parent.frame</span>()),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">"got logs: "</span>, <span class="at">sep =</span> <span class="st">"; "</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  logs <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(signif, <span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dput</span>(<span class="at">control =</span> <span class="st">"niceNames"</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">CustomCallback</span>(keras<span class="sc">$</span>callbacks<span class="sc">$</span>Callback) <span class="sc">%py_class%</span> {</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  on_train_begin <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"Starting training"</span>, logs)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  on_train_end <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"Stop training"</span>, logs)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  on_epoch_begin <span class="ot">&lt;-</span> <span class="cf">function</span>(epoch, <span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"Start epoch {epoch} of training"</span>, logs)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  on_epoch_end <span class="ot">&lt;-</span> <span class="cf">function</span>(epoch, <span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"End epoch {epoch} of training"</span>, logs)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  on_test_begin <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"Start testing"</span>, logs)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  on_test_end <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"Stop testing"</span>, logs)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  on_predict_begin <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"Start predicting"</span>, logs)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  on_predict_end <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"Stop predicting"</span>, logs)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  on_train_batch_begin <span class="ot">&lt;-</span> <span class="cf">function</span>(batch, <span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"...Training: start of batch {batch}"</span>, logs)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  on_train_batch_end <span class="ot">&lt;-</span> <span class="cf">function</span>(batch, <span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"...Training: end of batch {batch}"</span>,  logs)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  on_test_batch_begin <span class="ot">&lt;-</span> <span class="cf">function</span>(batch, <span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"...Evaluating: start of batch {batch}"</span>, logs)</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  on_test_batch_end <span class="ot">&lt;-</span> <span class="cf">function</span>(batch, <span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"...Evaluating: end of batch {batch}"</span>, logs)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  on_predict_batch_begin <span class="ot">&lt;-</span> <span class="cf">function</span>(batch, <span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"...Predicting: start of batch {batch}"</span>, logs)</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  on_predict_batch_end <span class="ot">&lt;-</span> <span class="cf">function</span>(batch, <span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">show</span>(<span class="st">"...Predicting: end of batch {batch}"</span>, logs)</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s try it out:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">get_model</span>()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span> <span class="fu">fit</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  mnist<span class="sc">$</span>train<span class="sc">$</span>x,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  mnist<span class="sc">$</span>train<span class="sc">$</span>y,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">batch_size =</span> <span class="dv">128</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">epochs =</span> <span class="dv">2</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">validation_split =</span> <span class="fl">0.5</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">callbacks =</span> <span class="fu">list</span>(<span class="fu">CustomCallback</span>())</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Starting training; got logs: list()
Start epoch 0 of training; got logs: list()
...Training: start of batch 0; got logs: list()
...Training: end of batch 0; got logs: list(loss = 29.3, mean_absolute_error = 4.58)
...Training: start of batch 1; got logs: list()
...Training: end of batch 1; got logs: list(loss = 462, mean_absolute_error = 16.1)
Start testing; got logs: list()
...Evaluating: start of batch 0; got logs: list()
...Evaluating: end of batch 0; got logs: list(loss = 28.3, mean_absolute_error = 4.53)
...Evaluating: start of batch 1; got logs: list()
...Evaluating: end of batch 1; got logs: list(loss = 27.2, mean_absolute_error = 4.36)
Stop testing; got logs: list(loss = 27.2, mean_absolute_error = 4.36)
End epoch 0 of training; got logs: list(loss = 462, mean_absolute_error = 16.1, val_loss = 27.2, 
    val_mean_absolute_error = 4.36)
Start epoch 1 of training; got logs: list()
...Training: start of batch 0; got logs: list()
...Training: end of batch 0; got logs: list(loss = 24.9, mean_absolute_error = 4.17)
...Training: start of batch 1; got logs: list()
...Training: end of batch 1; got logs: list(loss = 17.4, mean_absolute_error = 3.43)
Start testing; got logs: list()
...Evaluating: start of batch 0; got logs: list()
...Evaluating: end of batch 0; got logs: list(loss = 7.04, mean_absolute_error = 2.18)
...Evaluating: start of batch 1; got logs: list()
...Evaluating: end of batch 1; got logs: list(loss = 7.23, mean_absolute_error = 2.23)
Stop testing; got logs: list(loss = 7.23, mean_absolute_error = 2.23)
End epoch 1 of training; got logs: list(loss = 17.4, mean_absolute_error = 3.43, val_loss = 7.23, 
    val_mean_absolute_error = 2.23)
Stop training; got logs: list(loss = 17.4, mean_absolute_error = 3.43, val_loss = 7.23, 
    val_mean_absolute_error = 2.23)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">evaluate</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    mnist<span class="sc">$</span>test<span class="sc">$</span>x,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    mnist<span class="sc">$</span>test<span class="sc">$</span>y,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">batch_size =</span> <span class="dv">128</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="dv">0</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">callbacks =</span> <span class="fu">list</span>(<span class="fu">CustomCallback</span>())</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start testing; got logs: list()
...Evaluating: start of batch 0; got logs: list()
...Evaluating: end of batch 0; got logs: list(loss = 7.08, mean_absolute_error = 2.19)
...Evaluating: start of batch 1; got logs: list()
...Evaluating: end of batch 1; got logs: list(loss = 6.53, mean_absolute_error = 2.1)
...Evaluating: start of batch 2; got logs: list()
...Evaluating: end of batch 2; got logs: list(loss = 6.48, mean_absolute_error = 2.1)
...Evaluating: start of batch 3; got logs: list()
...Evaluating: end of batch 3; got logs: list(loss = 6.74, mean_absolute_error = 2.14)
Stop testing; got logs: list(loss = 6.74, mean_absolute_error = 2.14)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(mnist<span class="sc">$</span>test<span class="sc">$</span>x,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">batch_size =</span> <span class="dv">128</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">callbacks =</span> <span class="fu">list</span>(<span class="fu">CustomCallback</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start predicting; got logs: list()
...Predicting: start of batch 0; got logs: list()
...Predicting: end of batch 0; got logs: list(outputs = c(3.73, 2.91, 1.57, 3.98, 2.77, 2.2, 3.85, 3.83, 
3.76, 6.35, 1.77, 2.12, 5.25, 2.15, 3.28, 2.09, 3.89, 3.57, 3.51, 
3.11, 5.52, 3.23, 2.82, 3.28, 2.34, 4.9, 3.95, 3.55, 3.44, 2.36, 
3.96, 2.23, 3.69, 2.18, 4.83, 3.4, 4.18, 2.8, 1.79, 3.35, 1.44, 
3.12, 4.49, 1.41, 3.52, 3.06, 3.6, 3.03, 6.5, 3.17, 3.39, 4.19, 
3.69, 1.63, 2.74, 3.25, 3.29, 1.63, 5.23, 2, 5.38, 4.39, 2.71, 
3.48, 5.54, 3.21, 2.5, 3.17, 5.52, 1.4, 3.59, 2.49, 2.8, 5.57, 
3, 4.96, 2.65, 2.41, 4.04, 7.09, 5.13, 4.08, 3.72, 4.51, 3.37, 
5.2, 5.02, 3.77, 3.88, 2.96, 2.97, 4.07, 3.22, 6.16, 4.7, 6.25, 
2.36, 5.17, 3.09, 4.85, 2.12, 1.82, 4.42, 3.06, 2.82, 4.23, 2.07, 
1.8, 4.46, 3.69, 4.29, 3.09, 3.51, 5.25, 3.39, 3.7, 3.46, 3.51, 
3.51, 4.25, 4.68, 3.41, 3.3, 4.27, 5.21, 3.73, 1.91, 4.52))
...Predicting: start of batch 1; got logs: list()
...Predicting: end of batch 1; got logs: list(outputs = c(6.3, 3.93, 5.46, 5.58, 4.1, 4.88, 4.95, 3.42, 
2.63, 3.22, 2.91, 4.2, 2.62, 5.14, 2.46, 1.99, 4.55, 2.01, 4.91, 
4.76, 2.63, 1.41, 3.81, 3.57, 3.52, 2.31, 2.29, 5.03, 2.46, 2.46, 
2, 3.24, 4.28, 2.84, 4.51, 5.17, 2.89, 3.11, 3.71, 2.9, 2.87, 
3.72, 3.29, 5.59, 2.89, 2.22, 3.63, 1.26, 1.58, 3.97, 2.7, 4.23, 
2.48, 4.28, 3.4, 1.98, 4.14, 4.09, 4.41, 3.32, 3.17, 1.69, 3.78, 
2.64, 3.16, 3.69, 2.95, 2.41, 3.61, 5.06, 4.14, 5.59, 6.71, 2.81, 
1.74, 1.93, 1.64, 2.52, 6.5, 2.4, 2.71, 6.07, 3.25, 3.41, 6, 
2.82, 6.09, 4.12, 3.75, 3.77, 3.47, 2.94, 4.78, 3.35, 5.59, 4.97, 
1.03, 3.19, 5.46, 2.55, 2.1, 2.51, 3.67, 2.39, 4.19, 5.91, 2.84, 
3.72, 3.88, 3.27, 4.1, 2.55, 3.4, 2.97, 5.79, 4.28, 2.77, 2.56, 
1.31, 4.13, 4.52, 2.59, 6.05, 1.87, 7.07, 2.97, 3.55, 3.35))
...Predicting: start of batch 2; got logs: list()
...Predicting: end of batch 2; got logs: list(outputs = c(3.32, 4.43, 4.23, 2.23, 3.96, 3.17, 6.49, 4.19, 
4.02, 3.5, 4.57, 3.91, 3.1, 1.33, 3.32, 2.86, 2.45, 4.88, 4.56, 
4.63, 2.74, 5.64, 3.96, 2.14, 3.82, 5.21, 3.49, 3.05, 3.19, 2.26, 
4.19, 3.75, 2.84, 2.29, 4.25, 2.79, 6.24, 4.85, 2.57, 4.04, 3.23, 
1.4, 3.09, 4.28, 2.84, 5.26, 2.62, 1.88, 4.48, 1.69, 2.63, 3.37, 
4.86, 2.3, 2.38, 4.68, 3.68, 3.16, 3.25, 4.62, 3.62, 3.92, 3.06, 
2.76, 3.28, 2.9, 6.26, 3.08, 1.79, 3.57, 2.96, 3.56, 4.28, 3.41, 
2.85, 2.35, 2.78, 3.58, 2.47, 2.45, 4.53, 3.81, 3.35, 2.87, 4.06, 
1.74, 2.78, 2.96, 3.06, 3.9, 4.25, 5.86, 2.56, 3.59, 3.81, 3.84, 
2.16, 5.83, 1.67, 4.34, 4.41, 1.57, 4.11, 4.92, 3.9, 3.77, 3.56, 
2.11, 3.02, 3.08, 3.66, 2.65, 3.32, 2.69, 5.2, 2.48, 1.02, 4.39, 
3.8, 3.97, 4.54, 2.01, 2.4, 3.49, 0.672, 2.63, 4.1, 2.74))
...Predicting: start of batch 3; got logs: list()
...Predicting: end of batch 3; got logs: list(outputs = c(3.98, 1.8, 3.16, 2.09, 1.68, 5.87, 3.35, 4.76, 
4.12, 2.59, 3.35, 3.28, 3.7, 2.26, 2.86, 3.58, 3.97, 3.06, 2.84, 
3.92, 2.83, 4.27, 4.36, 2.73, 2.96, 3.29, 6.36, 2.56, 6.46, 5.96, 
3.87, 4.73, 2.9, 4.97, 3.12, 2.08, 2.39, 2.92, 4.73, 3.37, 1.61, 
4.6, 3.39, 2.29, 3.82, 3.82, 2.12, 3.38, 3.31, 3.72, 3.8, 5.14, 
4.24, 6.69, 3.59, 3.56, 4.39, 2.86, 4.56, 2.15, 3, 1.73, 4.48, 
5.53, 5.82, 4.98, 6.2, 5.78, 2.63, 1.99, 4.37, 2.94, 2.06, 3.41, 
4.61, 1.8, 4.61, 4.69, 5, 3.79, 4.89, 5.85, 4.24, 3.96, 5.09, 
3.62, 3.51, 3.61, 3.04, 1.54, 5.57, 3.78, 2.81, 2.8, 2.63, 2.34, 
1.32, 4.24, 3.71, 1.58, 3.5, 2.3, 4.65, 4.94, 3.75, 1.57, 1.92, 
3.89, 3.01, 4.08, 4.72, 6.54, 3.71, 3.6, 4.11, 2.43))
Stop predicting; got logs: list()</code></pre>
</div>
</div>
<section id="usage-of-logs" class="level3">
<h3 class="anchored" data-anchor-id="usage-of-logs">Usage of <code>logs</code></h3>
<p>The <code>logs</code> named list contains the loss value, and all the metrics at the end of a batch or epoch. Example includes the loss and mean absolute error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">LossAndErrorPrintingCallback</span>(keras<span class="sc">$</span>callbacks<span class="sc">$</span>Callback) <span class="sc">%py_class%</span> {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  on_train_batch_end <span class="ot">&lt;-</span> <span class="cf">function</span>(batch, <span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Up to batch %i, the average loss is %7.2f.</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                batch,  logs<span class="sc">$</span>loss))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  on_test_batch_end <span class="ot">&lt;-</span> <span class="cf">function</span>(batch, <span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Up to batch %i, the average loss is %7.2f.</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                batch, logs<span class="sc">$</span>loss))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  on_epoch_end <span class="ot">&lt;-</span> <span class="cf">function</span>(epoch, <span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"The average loss for epoch %2i is %9.2f and mean absolute error is %7.2f.</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>      epoch, logs<span class="sc">$</span>loss, logs<span class="sc">$</span>mean_absolute_error</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">get_model</span>()</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span> <span class="fu">fit</span>(</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  mnist<span class="sc">$</span>train<span class="sc">$</span>x,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  mnist<span class="sc">$</span>train<span class="sc">$</span>y,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">batch_size =</span> <span class="dv">128</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">epochs =</span> <span class="dv">2</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">callbacks =</span> <span class="fu">list</span>(<span class="fu">LossAndErrorPrintingCallback</span>())</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Up to batch 0, the average loss is   23.28.
Up to batch 1, the average loss is  440.17.
Up to batch 2, the average loss is  299.87.
Up to batch 3, the average loss is  232.65.
The average loss for epoch  0 is    232.65 and mean absolute error is    9.52.
Up to batch 0, the average loss is    7.37.
Up to batch 1, the average loss is    6.63.
Up to batch 2, the average loss is    6.33.
Up to batch 3, the average loss is    6.07.
The average loss for epoch  1 is      6.07 and mean absolute error is    2.03.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">=</span> model <span class="sc">%&gt;%</span> <span class="fu">evaluate</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  mnist<span class="sc">$</span>test<span class="sc">$</span>x,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  mnist<span class="sc">$</span>test<span class="sc">$</span>y,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">batch_size =</span> <span class="dv">128</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">callbacks =</span> <span class="fu">list</span>(<span class="fu">LossAndErrorPrintingCallback</span>())</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Up to batch 0, the average loss is    5.40.
Up to batch 1, the average loss is    4.96.
Up to batch 2, the average loss is    4.97.
Up to batch 3, the average loss is    4.99.</code></pre>
</div>
</div>
</section>
</section>
<section id="usage-of-selfmodel-attribute" class="level2">
<h2 class="anchored" data-anchor-id="usage-of-selfmodel-attribute">Usage of <code>self$model</code> attribute</h2>
<p>In addition to receiving log information when one of their methods is called, callbacks have access to the model associated with the current round of training/evaluation/inference: <code>self$model</code>.</p>
<p>Here are of few of the things you can do with <code>self$model</code> in a callback:</p>
<ul>
<li>Set <code>self$model$stop_training &lt;- TRUE</code> to immediately interrupt training.</li>
<li>Mutate hyperparameters of the optimizer (available as <code>self$model$optimizer</code>), such as <code>self$model$optimizer$learning_rate</code>.</li>
<li>Save the model at period intervals.</li>
<li>Record the output of <code>predict(model)</code> on a few test samples at the end of each epoch, to use as a sanity check during training.</li>
<li>Extract visualizations of intermediate features at the end of each epoch, to monitor what the model is learning over time.</li>
<li>etc.</li>
</ul>
<p>Let’s see this in action in a couple of examples.</p>
</section>
<section id="examples-of-keras-callback-applications" class="level2">
<h2 class="anchored" data-anchor-id="examples-of-keras-callback-applications">Examples of Keras callback applications</h2>
<section id="early-stopping-at-minimum-loss" class="level3">
<h3 class="anchored" data-anchor-id="early-stopping-at-minimum-loss">Early stopping at minimum loss</h3>
<p>This first example shows the creation of a <code>Callback</code> that stops training when the minimum of loss has been reached, by setting the attribute <code>self$model$stop_training</code> (boolean). Optionally, you can provide an argument <code>patience</code> to specify how many epochs we should wait before stopping after having reached a local minimum.</p>
<p><code>keras$callbacks$EarlyStopping</code> provides a more complete and general implementation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">EarlyStoppingAtMinLoss</span>(keras<span class="sc">$</span>callbacks<span class="sc">$</span>Callback) <span class="sc">%py_class%</span> {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Stop training when the loss is at its min, i.e. the loss stops decreasing.</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="st">  Arguments:</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="st">      patience: Number of epochs to wait after min has been hit. After this</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="st">        number of no improvement, training stops.</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="st">  "</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  initialize <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">patience =</span> <span class="dv">0</span>) {</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># call keras$callbacks$Callback$__init__(), so it can setup `self`</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    super<span class="sc">$</span><span class="fu">initialize</span>()</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>patience <span class="ot">&lt;-</span> patience</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># best_weights to store the weights at which the minimum loss occurs.</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>best_weights <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  on_train_begin <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">logs =</span> <span class="cn">NULL</span>) {</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The number of epoch it has waited when loss is no longer minimum.</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>wait <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The epoch the training stops at.</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>stopped_epoch <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize the best as infinity.</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>best <span class="ot">&lt;-</span> <span class="cn">Inf</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  on_epoch_end <span class="ot">&lt;-</span> <span class="cf">function</span>(epoch, <span class="at">logs =</span> <span class="cn">NULL</span>) {</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    current <span class="ot">&lt;-</span> logs<span class="sc">$</span>loss</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (current <span class="sc">&lt;</span> self<span class="sc">$</span>best) {</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>best <span class="ot">&lt;-</span> current</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>wait <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Record the best weights if current results is better (less).</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>best_weights <span class="ot">&lt;-</span> self<span class="sc">$</span>model<span class="sc">$</span><span class="fu">get_weights</span>()</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>wait <span class="sc">%&lt;&gt;%</span> <span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">1</span>)</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (self<span class="sc">$</span>wait <span class="sc">&gt;=</span> self<span class="sc">$</span>patience) {</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>stopped_epoch <span class="ot">&lt;-</span> epoch</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>model<span class="sc">$</span>stop_training <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"Restoring model weights from the end of the best epoch.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>model<span class="sc">$</span><span class="fu">set_weights</span>(self<span class="sc">$</span>best_weights)</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>  on_train_end <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">logs =</span> <span class="cn">NULL</span>)</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (self<span class="sc">$</span>stopped_epoch <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Epoch %05d: early stopping</span><span class="sc">\n</span><span class="st">"</span>, self<span class="sc">$</span>stopped_epoch <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">get_model</span>()</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span> <span class="fu">fit</span>(</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>  mnist<span class="sc">$</span>train<span class="sc">$</span>x,</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>  mnist<span class="sc">$</span>train<span class="sc">$</span>y,</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">batch_size =</span> <span class="dv">64</span>,</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">steps_per_epoch =</span> <span class="dv">5</span>,</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">epochs =</span> <span class="dv">30</span>,</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span>,</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">callbacks =</span> <span class="fu">list</span>(<span class="fu">LossAndErrorPrintingCallback</span>(),</span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">EarlyStoppingAtMinLoss</span>())</span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Up to batch 0, the average loss is   20.51.
Up to batch 1, the average loss is  457.14.
Up to batch 2, the average loss is  313.42.
Up to batch 3, the average loss is  237.60.
Up to batch 4, the average loss is  191.72.
The average loss for epoch  0 is    191.72 and mean absolute error is    8.08.
Up to batch 0, the average loss is    6.77.
Up to batch 1, the average loss is    5.98.
Up to batch 2, the average loss is    5.80.
Up to batch 3, the average loss is    5.73.
Up to batch 4, the average loss is    5.50.
The average loss for epoch  1 is      5.50 and mean absolute error is    1.98.
Up to batch 0, the average loss is    4.17.
Up to batch 1, the average loss is    4.51.
Up to batch 2, the average loss is    4.30.
Up to batch 3, the average loss is    4.32.
Up to batch 4, the average loss is    4.21.
The average loss for epoch  2 is      4.21 and mean absolute error is    1.67.
Up to batch 0, the average loss is    4.06.
Up to batch 1, the average loss is    3.78.
Up to batch 2, the average loss is    4.21.
Up to batch 3, the average loss is    4.23.
Up to batch 4, the average loss is    4.55.
The average loss for epoch  3 is      4.55 and mean absolute error is    1.74.
Restoring model weights from the end of the best epoch.
Epoch 00004: early stopping</code></pre>
</div>
</div>
</section>
<section id="learning-rate-scheduling" class="level3">
<h3 class="anchored" data-anchor-id="learning-rate-scheduling">Learning rate scheduling</h3>
<p>In this example, we show how a custom Callback can be used to dynamically change the learning rate of the optimizer during the course of training.</p>
<p>See <code>keras$callbacks$LearningRateScheduler</code> for a more general implementations (in RStudio, press F1 while the cursor is over <code>LearningRateScheduler</code> and a browser will open to <a href="https://www.tensorflow.org/versions/r2.5/api_docs/python/tf/keras/callbacks/LearningRateScheduler">this page</a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CustomLearningRateScheduler</span>(keras<span class="sc">$</span>callbacks<span class="sc">$</span>Callback) <span class="sc">%py_class%</span> {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Learning rate scheduler which sets the learning rate according to schedule.</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="st">  Arguments:</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="st">      schedule: a function that takes an epoch index</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="st">          (integer, indexed from 0) and current learning rate</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="st">          as inputs and returns a new learning rate as output (float).</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="st">  "</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">__init__</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(schedule) {</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">super</span>()<span class="sc">$</span><span class="st">`</span><span class="at">__init__</span><span class="st">`</span>()</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>schedule <span class="ot">&lt;-</span> schedule</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  on_epoch_begin <span class="ot">&lt;-</span> <span class="cf">function</span>(epoch, <span class="at">logs =</span> <span class="cn">NULL</span>) {</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="do">## When in doubt about what types of objects are in scope (e.g., self$model)</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="do">## use a debugger to interact with the actual objects at the console!</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># browser()</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="st">"learning_rate"</span> <span class="sc">%in%</span> <span class="fu">names</span>(self<span class="sc">$</span>model<span class="sc">$</span>optimizer))</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">'Optimizer must have a "learning_rate" attribute.'</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # Get the current learning rate from model's optimizer.</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># use as.numeric() to convert the tf.Variable to an R numeric</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    lr <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(self<span class="sc">$</span>model<span class="sc">$</span>optimizer<span class="sc">$</span>learning_rate)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # Call schedule function to get the scheduled learning rate.</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    scheduled_lr <span class="ot">&lt;-</span> self<span class="sc">$</span><span class="fu">schedule</span>(epoch, lr)</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # Set the value back to the optimizer before this epoch starts</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>    self<span class="sc">$</span>model<span class="sc">$</span>optimizer<span class="sc">$</span>learning_rate <span class="ot">&lt;-</span> scheduled_lr</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Epoch %05d: Learning rate is %6.4f.</span><span class="sc">\n</span><span class="st">"</span>, epoch, scheduled_lr))</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>LR_SCHEDULE <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(<span class="sc">~</span> start_epoch, <span class="sc">~</span> learning_rate,</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>                                           <span class="dv">0</span>,           <span class="fl">0.1</span>  ,</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>                                           <span class="dv">3</span>,           <span class="fl">0.05</span> ,</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>                                           <span class="dv">6</span>,           <span class="fl">0.01</span> ,</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>                                           <span class="dv">9</span>,           <span class="fl">0.005</span>,</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>                                          <span class="dv">12</span>,           <span class="fl">0.001</span>)</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>lr_schedule <span class="ot">&lt;-</span> <span class="cf">function</span>(epoch, learning_rate) {</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Helper function to retrieve the scheduled learning rate based on epoch."</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (epoch <span class="sc">&lt;=</span> <span class="fu">last</span>(LR_SCHEDULE<span class="sc">$</span>start_epoch))</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with</span>(LR_SCHEDULE, learning_rate[<span class="fu">which.min</span>(epoch <span class="sc">&gt;</span> start_epoch)])</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>    learning_rate</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">get_model</span>()</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span> <span class="fu">fit</span>(</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>  mnist<span class="sc">$</span>train<span class="sc">$</span>x,</span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>  mnist<span class="sc">$</span>train<span class="sc">$</span>y,</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">batch_size =</span> <span class="dv">64</span>,</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">steps_per_epoch =</span> <span class="dv">5</span>,</span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">epochs =</span> <span class="dv">15</span>,</span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span>,</span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">callbacks =</span> <span class="fu">list</span>(</span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LossAndErrorPrintingCallback</span>(),</span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CustomLearningRateScheduler</span>(lr_schedule)</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Epoch 00000: Learning rate is 0.1000.
Up to batch 0, the average loss is   26.16.
Up to batch 1, the average loss is  517.86.
Up to batch 2, the average loss is  355.71.
Up to batch 3, the average loss is  268.95.
Up to batch 4, the average loss is  216.62.
The average loss for epoch  0 is    216.62 and mean absolute error is    8.60.

Epoch 00001: Learning rate is 0.0500.
Up to batch 0, the average loss is    6.34.
Up to batch 1, the average loss is    5.76.
Up to batch 2, the average loss is    6.21.
Up to batch 3, the average loss is    6.12.
Up to batch 4, the average loss is    5.98.
The average loss for epoch  1 is      5.98 and mean absolute error is    2.03.

Epoch 00002: Learning rate is 0.0500.
Up to batch 0, the average loss is    5.61.
Up to batch 1, the average loss is    5.14.
Up to batch 2, the average loss is    5.06.
Up to batch 3, the average loss is    4.66.
Up to batch 4, the average loss is    4.47.
The average loss for epoch  2 is      4.47 and mean absolute error is    1.71.

Epoch 00003: Learning rate is 0.0500.
Up to batch 0, the average loss is    5.25.
Up to batch 1, the average loss is    4.60.
Up to batch 2, the average loss is    4.37.
Up to batch 3, the average loss is    4.35.
Up to batch 4, the average loss is    4.25.
The average loss for epoch  3 is      4.25 and mean absolute error is    1.70.

Epoch 00004: Learning rate is 0.0100.
Up to batch 0, the average loss is    4.58.
Up to batch 1, the average loss is    3.97.
Up to batch 2, the average loss is    4.12.
Up to batch 3, the average loss is    3.85.
Up to batch 4, the average loss is    3.58.
The average loss for epoch  4 is      3.58 and mean absolute error is    1.54.

Epoch 00005: Learning rate is 0.0100.
Up to batch 0, the average loss is    3.71.
Up to batch 1, the average loss is    3.69.
Up to batch 2, the average loss is    3.72.
Up to batch 3, the average loss is    3.84.
Up to batch 4, the average loss is    3.79.
The average loss for epoch  5 is      3.79 and mean absolute error is    1.58.

Epoch 00006: Learning rate is 0.0100.
Up to batch 0, the average loss is    4.96.
Up to batch 1, the average loss is    3.81.
Up to batch 2, the average loss is    3.82.
Up to batch 3, the average loss is    3.72.
Up to batch 4, the average loss is    3.74.
The average loss for epoch  6 is      3.74 and mean absolute error is    1.53.

Epoch 00007: Learning rate is 0.0050.
Up to batch 0, the average loss is    3.24.
Up to batch 1, the average loss is    3.59.
Up to batch 2, the average loss is    3.25.
Up to batch 3, the average loss is    3.20.
Up to batch 4, the average loss is    3.34.
The average loss for epoch  7 is      3.34 and mean absolute error is    1.51.

Epoch 00008: Learning rate is 0.0050.
Up to batch 0, the average loss is    4.55.
Up to batch 1, the average loss is    3.63.
Up to batch 2, the average loss is    3.25.
Up to batch 3, the average loss is    3.15.
Up to batch 4, the average loss is    3.24.
The average loss for epoch  8 is      3.24 and mean absolute error is    1.42.

Epoch 00009: Learning rate is 0.0050.
Up to batch 0, the average loss is    3.04.
Up to batch 1, the average loss is    3.14.
Up to batch 2, the average loss is    3.58.
Up to batch 3, the average loss is    3.50.
Up to batch 4, the average loss is    3.64.
The average loss for epoch  9 is      3.64 and mean absolute error is    1.57.

Epoch 00010: Learning rate is 0.0010.
Up to batch 0, the average loss is    3.22.
Up to batch 1, the average loss is    3.00.
Up to batch 2, the average loss is    2.91.
Up to batch 3, the average loss is    3.10.
Up to batch 4, the average loss is    3.11.
The average loss for epoch 10 is      3.11 and mean absolute error is    1.41.

Epoch 00011: Learning rate is 0.0010.
Up to batch 0, the average loss is    3.17.
Up to batch 1, the average loss is    3.73.
Up to batch 2, the average loss is    3.25.
Up to batch 3, the average loss is    3.37.
Up to batch 4, the average loss is    3.54.
The average loss for epoch 11 is      3.54 and mean absolute error is    1.51.

Epoch 00012: Learning rate is 0.0010.
Up to batch 0, the average loss is    1.88.
Up to batch 1, the average loss is    2.45.
Up to batch 2, the average loss is    2.88.
Up to batch 3, the average loss is    2.80.
Up to batch 4, the average loss is    2.82.
The average loss for epoch 12 is      2.82 and mean absolute error is    1.35.

Epoch 00013: Learning rate is 0.0010.
Up to batch 0, the average loss is    3.00.
Up to batch 1, the average loss is    2.92.
Up to batch 2, the average loss is    2.96.
Up to batch 3, the average loss is    3.11.
Up to batch 4, the average loss is    3.06.
The average loss for epoch 13 is      3.06 and mean absolute error is    1.40.

Epoch 00014: Learning rate is 0.0010.
Up to batch 0, the average loss is    3.70.
Up to batch 1, the average loss is    3.69.
Up to batch 2, the average loss is    3.58.
Up to batch 3, the average loss is    3.52.
Up to batch 4, the average loss is    3.29.
The average loss for epoch 14 is      3.29 and mean absolute error is    1.45.</code></pre>
</div>
</div>
</section>
<section id="built-in-keras-callbacks" class="level3">
<h3 class="anchored" data-anchor-id="built-in-keras-callbacks">Built-in Keras callbacks</h3>
<p>Be sure to check out the existing Keras callbacks by reading the <a href="https://keras.io/api/callbacks/">API docs</a>. Applications include logging to CSV, saving the model, visualizing metrics in TensorBoard, and a lot more!</p>
</section>
</section>
<section id="environment-details" class="level2">
<h2 class="anchored" data-anchor-id="environment-details">Environment Details</h2>
<div class="callout-note callout callout-style-simple callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tensorflow Version
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>tensorflow<span class="sc">::</span><span class="fu">tf_config</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>TensorFlow v2.9.1 (~/.virtualenvs/r-tensorflow-site/lib/python3.9/site-packages/tensorflow)
Python v3.9 (~/.virtualenvs/r-tensorflow-site/bin/python)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout-note callout callout-style-simple callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
R Environment Information
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.2.1 (2022-06-23)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04.4 LTS

Matrix products: default
BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/libmkl_rt.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] keras_2.9.0.9000      tensorflow_2.9.0.9000

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.9           compiler_4.2.1       pillar_1.7.0        
 [4] envir_0.2.1          base64enc_0.1-3      tools_4.2.1         
 [7] zeallot_0.1.0        digest_0.6.29        tibble_3.1.7        
[10] jsonlite_1.8.0       evaluate_0.15        lifecycle_1.0.1     
[13] lattice_0.20-45      pkgconfig_2.0.3      png_0.1-7           
[16] rlang_1.0.4          Matrix_1.4-1         DBI_1.1.3           
[19] cli_3.3.0            yaml_2.3.5           xfun_0.31           
[22] fastmap_1.1.0        stringr_1.4.0        dplyr_1.0.9         
[25] knitr_1.39           generics_0.1.3       htmlwidgets_1.5.4   
[28] vctrs_0.4.1          rprojroot_2.0.3      tidyselect_1.1.2    
[31] grid_4.2.1           here_1.0.1           reticulate_1.25-9000
[34] glue_1.6.2           R6_2.5.1             fansi_1.0.3         
[37] rmarkdown_2.14       purrr_0.3.4          magrittr_2.0.3      
[40] whisker_0.4          tfruns_1.5.0         htmltools_0.5.2     
[43] ellipsis_0.3.2       assertthat_0.2.1     utf8_1.2.2          
[46] stringi_1.7.8        crayon_1.5.1        </code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout-note callout callout-style-simple callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Python Environment Information
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system2</span>(reticulate<span class="sc">::</span><span class="fu">py_exe</span>(), <span class="fu">c</span>(<span class="st">"-m pip freeze"</span>), <span class="at">stdout =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">writeLines</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>absl-py==1.1.0
asttokens==2.0.5
astunparse==1.6.3
backcall==0.2.0
beautifulsoup4==4.11.1
cachetools==5.2.0
certifi==2022.6.15
charset-normalizer==2.1.0
decorator==5.1.1
dill==0.3.5.1
etils==0.6.0
executing==0.8.3
filelock==3.7.1
flatbuffers==1.12
gast==0.4.0
gdown==4.5.1
google-auth==2.9.0
google-auth-oauthlib==0.4.6
google-pasta==0.2.0
googleapis-common-protos==1.56.4
grpcio==1.47.0
h5py==3.7.0
idna==3.3
importlib-metadata==4.12.0
importlib-resources==5.8.0
ipython==8.4.0
jedi==0.18.1
keras==2.9.0
Keras-Preprocessing==1.1.2
keras-tuner==1.1.2
kt-legacy==1.0.4
libclang==14.0.1
Markdown==3.3.7
matplotlib-inline==0.1.3
numpy==1.23.1
oauthlib==3.2.0
opt-einsum==3.3.0
packaging==21.3
pandas==1.4.3
parso==0.8.3
pexpect==4.8.0
pickleshare==0.7.5
Pillow==9.2.0
promise==2.3
prompt-toolkit==3.0.30
protobuf==3.19.4
ptyprocess==0.7.0
pure-eval==0.2.2
pyasn1==0.4.8
pyasn1-modules==0.2.8
pydot==1.4.2
Pygments==2.12.0
pyparsing==3.0.9
PySocks==1.7.1
python-dateutil==2.8.2
pytz==2022.1
PyYAML==6.0
requests==2.28.1
requests-oauthlib==1.3.1
rsa==4.8
scipy==1.8.1
six==1.16.0
soupsieve==2.3.2.post1
stack-data==0.3.0
tensorboard==2.9.1
tensorboard-data-server==0.6.1
tensorboard-plugin-wit==1.8.1
tensorflow==2.9.1
tensorflow-datasets==4.6.0
tensorflow-estimator==2.9.0
tensorflow-hub==0.12.0
tensorflow-io-gcs-filesystem==0.26.0
tensorflow-metadata==1.9.0
termcolor==1.1.0
toml==0.10.2
tqdm==4.64.0
traitlets==5.3.0
typing_extensions==4.3.0
urllib3==1.26.10
wcwidth==0.2.5
Werkzeug==2.1.2
wrapt==1.14.1
zipp==3.8.1</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout-note callout callout-style-simple callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Additional Information
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>TF Devices:
-  PhysicalDevice(name='/physical_device:CPU:0', device_type='CPU') 
-  PhysicalDevice(name='/physical_device:GPU:0', device_type='GPU') 
CPU cores: 12 
Date rendered: 2022-07-14 
Page render time: 8 seconds</code></pre>
</div>
</div>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../guides/keras/understanding_masking_and_padding.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Understanding masking &amp; padding</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../guides/keras/transfer_learning.html" class="pagination-link">
        <span class="nav-page-text">Transfer learning and fine-tuning</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>